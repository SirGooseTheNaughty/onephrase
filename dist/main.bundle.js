(()=>{"use strict";const t=window.CUSTOM_CATEGORY_ID||"710715095531",e=window.MAX_LENGTH||29,n=window.MIN_LENGTH||1,o=window.TOO_SHORT_MSG||"Надпись не может быть пустой",r=window.TOO_LONG_MSG||"Надпись не может быть длиннее 29 символов";function c(e){const n=e?.dataset.productPartUid;return n===t}const i=()=>localStorage.setItem("tcart",JSON.stringify(window.tcart)),s=t=>window.tcart.products[t],d=(t,e,n)=>{if(t.quantity+e<1)return window.tcart__product__del?.(n);t.quantity+=e,t.amount=t.quantity*t.price,tcart__reDrawProducts(),p(),tcart__updateTotalProductsinCartObj(),tcart__reDrawTotal(),i()},a=(t="div",e=[])=>{const n=document.createElement(t);return Array.isArray(e)?n.classList.add(...e):n.classList.add(e),n},u=(t,e,n)=>{const o=a("div","text-controls__row"),r=(t=>{const e=a("div",["t706__product-title__option","text-controls__row-title"]);return e.textContent=`надпись: ${t.text}`,e})(e),c=((t,e,n)=>{const{text:o,amount:r}=t,c=a("div",["t706__product-plusminus","text-controls__row-plus-minus"]),i=a("span",["t706__product-minus","text-controls__row-minus"]);i.innerHTML='<img src="https://static.tildacdn.com/lib/linea/c8eecd27-9482-6c4f-7896-3eb09f6a1091/arrows_circle_minus.svg" style="width:16px;height:16px;border:0;">',i.addEventListener("click",(()=>((t,e,n)=>{const o=s(e),r=o.textOptions.find((({text:e})=>e===t)),c=r.amount-1;r.amount=c,o.textOptions=o.textOptions.filter((({amount:t})=>t>0)),d(o,-1,n)})(o,e,n)));const u=a("span",["t706__product-plus","text-controls__row-plus"]);u.innerHTML='<img src="https://static.tildacdn.com/lib/linea/c47d1e0c-6880-dc39-ae34-521197f7fba7/arrows_circle_plus.svg" style="width:16px;height:16px;border:0;">',u.addEventListener("click",(()=>((t,e)=>{const n=s(e);n.textOptions.find((({text:e})=>e===t)).amount+=1,d(n,1)})(o,e)));const l=a("span",["t706__product-quantity","text-controls__row-quantity"]);return l.textContent=r,c.appendChild(i),c.appendChild(l),c.appendChild(u),c})(e,n,o),i=((t,e)=>{const n=a("div",["t706__product-amount","text-controls__row-total"]),o=a("div",["t706__cartwin-prodamount-price","text-controls__row-total-price"]);o.textContent=""+t.price*e.amount;const r=a("div",["t706__cartwin-prodamount-currency","text-controls__row-total-currency"]);return r.textContent=window.tcart.currency,n.appendChild(o),n.appendChild(r),n})(t,e),u=((t,e,n)=>{const o=a("div",["t706__product-del-wrapper","text-controls__row-delete"]);return o.innerHTML='\n        <span class="t706__product-del">\n            <img src="https://static.tildacdn.com/lib/linea/1bec3cd7-e9d1-2879-5880-19b597ef9f1a/arrows_circle_remove.svg" style="width:20px;height:20px;border:0;">\n        </span>\n    ',o.addEventListener("click",(()=>((t,e,n)=>{const o=s(e);console.log(o);const r=o.textOptions.find((({text:e})=>e===t)).amount,c=o.textOptions.filter((({text:e})=>e!==t));if(0===c.length)return window.tcart__product__del?.(n);o.textOptions=c,d(o,-r,n)})(t.text,e,n))),o})(e,n,o);return o.appendChild(r),o.appendChild(c),o.appendChild(i),o.appendChild(u),o},l=(t,e)=>{const n=window.tcart.products[e],o=n?.textOptions;if(!o)return;t.classList.add("custom-cart-product");const r=a("div","text-controls");o.forEach((t=>{r.appendChild(u(n,t,e))})),t.appendChild(r)};function p(){cart.querySelectorAll(".t706__product").forEach(((t,e)=>{l(t,t?.dataset?.cartProductI||e)}))}const _={PROD:"prod",DEV:"dev",LOCAL:"local"};(()=>{const t=localStorage.getItem("mode")||_.PROD;for(const e of Object.values(_))e!==t&&document.querySelectorAll(`script[data-mode="${e}"], style[data-mode="${e}"]`).forEach((t=>t.remove()))})(),function(){let t,s,d;const a=new MutationObserver((function(e){for(const n of e)if("class"===n.attributeName&&n.target.classList.contains("t-popup_show"))return void(c(t)?u():((t=>{const e=t.querySelector(".prod-text-input");e&&e.remove()})(t),l(!0),p()))}));function u(){s=((t,c=(()=>{}))=>{const i=t.querySelector(".prod-text-input");if(i)return i;const{wrapper:s,input:d,label:a}=function(){const t=document.createElement("div");t.classList.add("prod-text-input");const e=document.createElement("input");e.setAttribute("type","text"),e.classList.add("prod-text-input__input");const n=document.createElement("div");n.classList.add("t-product__option-title","prod-text-input__title"),n.textContent="надпись для нанесения (до 29 симв)";const o=document.createElement("div");return o.classList.add("prod-text-input__label"),t.appendChild(n),t.appendChild(e),t.appendChild(o),{wrapper:t,input:e,label:o}}();function u(t="",i=!0){const d=t.length<n,u=t.length>e,l=!d&&!u;l?(s.classList.remove("invalid"),a.textContent=""):i&&(a.textContent=d?o:r,s.classList.add("invalid")),c(l)}return t.querySelector(".js-product-controls-wrapper").appendChild(s),u(d?.value,!1),d.addEventListener("input",(t=>u(t?.target?.value))),d})(t,l),p(),d.addEventListener("click",_)}function l(t){t?d.classList.remove("disabled"):d.classList.add("disabled")}function p(){d.removeEventListener("click",_)}function _(){((t,e)=>{if(!window.tcart?.products)return;const n=e?.dataset?.productGenUid||null;if(!n)return console.error("Нет uid для продукта",e);const o=(t=>{const e=t.querySelector(".t-store__prod__quantity-input")?.value;return e&&!isNaN(e)?parseInt(e,10):1})(e),r=[...e.querySelectorAll(".t-product__option-variants")].reduce(((t,e)=>{const n=e.querySelector(".t-product__option-item_active input");return n?(t[n.name]=n.value,t):t}),{});setTimeout((()=>{((t,e,n,o)=>{window.tcart.products=window.tcart.products.map((r=>{console.log(JSON.parse(JSON.stringify(r)));const c=((t,e,n)=>{const{options:o,gen_uid:r}=t;if(r!==e)return!1;for(const t of o)if(n[t.option]!==t.variant)return!1;return!0})(r,e,n);if(!c)return r;if(!r.textOptions)return{...r,textOptions:[{text:t,amount:o}]};if(!r.textOptions.find((({text:e})=>e===t)))return{...r,textOptions:[...r.textOptions,{text:t,amount:o}]};const i=r.textOptions.map((e=>e.text===t?{...e,amount:e.amount+o}:e));return{...r,textOptions:i}}))})(t,n,r,o),i()}),150)})(s.value,t)}window.addEventListener("load",(()=>{(function(t=null,e=null){return new Promise((n=>{const o=t?()=>document.querySelector(t):e,r=o();if(r)return n(r);const c=new MutationObserver((()=>{const t=o();t&&(c.disconnect(),n(t))}));c.observe(document.body,{childList:!0,subtree:!0})}))})(".js-store-product").then((e=>{t=e,d=t.querySelector('[href="#order"]');const n=e.closest(".t-popup");n?a.observe(n,{attributes:!0}):c(t)&&u()}))}))}(),function(){const t=new MutationObserver((function(t){for(const e of t)if("class"===e.attributeName&&e.target.classList.contains("t706__cartwin_showed"))return setTimeout(p,250)}));(function(t=null,e=null){return new Promise((n=>{const o=t?()=>document.querySelector(t):e,r=o();if(r)return n(r);const c=new MutationObserver((()=>{const t=o();t&&(c.disconnect(),n(t))}));c.observe(document.body,{childList:!0,subtree:!0})}))})(".t706__cartwin").then((e=>{window.cart=e,t.observe(e,{attributes:!0})}))}()})();